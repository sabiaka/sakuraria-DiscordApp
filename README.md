# Sakuraria Discord Bot

## 概要
このBotは、SakurariaのDiscordサーバーで使うためのBotです。主に以下の機能を提供します：

- 期ごとのカテゴリとチャンネルの自動作成
- リアクションロールによるクラス選択
- 職員とOBのロール管理
- 期の移行管理（OBロール付与とチャンネル名更新）
- イベント管理（カテゴリ、チャンネル、ロールの作成と削除）

## コマンドの分類
このBotのコマンドは大きく2つのカテゴリに分かれています：

### サクラリア系コマンド
- 期の管理に関するコマンド（`/sakuraria_`で始まるコマンド）
- サーバーの基本構造を管理するコマンド
- 例：期の作成、削除、ロール管理、チャンネル管理など

### イベント系コマンド
- イベント管理に関するコマンド（`/`で始まるコマンド）
- 一時的なイベントのための機能を提供
- 例：イベントの作成、削除、ロール付与など

## フォルダ構成
```
sakuraria-DiscordApp/
├── cogs/                      # コマンドの実装
│   ├── events/               # イベント系コマンド
│   │   ├── __init__.py      # イベントモジュールの初期化
│   │   ├── checks.py        # 権限チェック
│   │   ├── event_management.py  # イベント作成・削除
│   │   └── role_management.py   # ロール付与・削除
│   └── sakuraria/           # sakuraria系コマンド
│       ├── __init__.py      # sakurariaモジュールの初期化
│       ├── roles.py         # ロール管理
│       ├── seasons.py       # 期の管理
│       ├── channels.py      # チャンネル管理
│       ├── reaction_roles.py # リアクションロール
│       └── categories.py    # カテゴリ管理
├── config/                   # 設定ファイル
│   └── settings.py          # 各種設定
├── utils/                    # ユーティリティ
│   ├── checks.py            # 権限チェック
│   └── helpers.py           # ヘルパー関数
├── main.py                  # メインスクリプト
├── reaction_roles.json      # リアクションロール設定
├── requirements.txt         # 依存パッケージ
└── README.md               # このファイル
```

## 機能一覧

### 1. 期の作成と管理
- `/sakuraria_new_season [学期] [クラス数]` - 新しい期のカテゴリとチャンネルを作成します
  - 教員用カテゴリ（👨‍🏫）と生徒用カテゴリ（👨‍🎓）を作成
  - 期全体の連絡チャンネル（📗📢）を作成
  - クラスごとの雑談（📗💬）・写真（📗📸）・連絡（📗📢）チャンネルを作成
  - 教員用チャンネル（📗📝）を作成
  - 期生・期職員のロールを作成
  - クラスごとの生徒・職員ロールを作成
  - リアクションロールメッセージを自動生成

- `/sakuraria_delete_season [開始学期] [終了学期]` - 指定した期のカテゴリとチャンネルを削除します
  - 教員用・生徒用カテゴリとその中のチャンネルを削除
  - 期生・期職員のロールを削除
  - クラスごとの生徒・職員ロールを削除
  - リアクションロールメッセージを削除

### 2. デバッグ用コマンド
以下のコマンドは`/sakuraria_new_season`の機能を個別に実行するためのものです。デバッグや特定の機能だけを再実行したい場合に使用します。

- `/sakuraria_create_roles [学期] [クラス数]` - ロールの作成のみを行います
  - 期全体のロール（期生、期職員）を作成
  - クラスごとのロール（生徒、職員）を作成

- `/sakuraria_create_categories [学期]` - カテゴリの作成のみを行います
  - 教員用カテゴリ（👨‍🏫）を作成
  - 生徒用カテゴリ（👨‍🎓）を作成
  - 注意: 先に`/sakuraria_create_roles`を実行する必要があります

- `/sakuraria_create_channels [学期] [クラス数]` - チャンネルの作成のみを行います
  - 期全体の連絡チャンネル（📗📢）を作成
  - 教員用チャンネル（📗📝）を作成
  - クラスごとの雑談（📗💬）・写真（📗📸）・連絡（📗📢）チャンネルを作成
  - 注意: 先に`/sakuraria_create_roles`と`/sakuraria_create_categories`を実行する必要があります

- `/sakuraria_create_reaction_roles [学期] [クラス数]` - リアクションロールメッセージの作成のみを行います
  - 職員用のリアクションロールメッセージを作成
  - 生徒用のリアクションロールメッセージを作成
  - 注意: 先に`/sakuraria_create_roles`を実行する必要があります

### 3. ロール管理
- `/sakuraria_create_first_roll` - 職員とOBのロールを作成します
  - 職員ロール（赤色、オンラインメンバーとは別に表示）
  - OBロール（青色）

- `/sakuraria_next_season [学期]` - 指定した期の生徒をOBに移行します
  - 指定した期の生徒にOBロールを付与
  - チャンネル名の絵文字を📗から📙に更新
  - 注意: 1期生が既にOBロールを持っている場合は実行できません

### 4. イベント管理
- `/create_event [イベント名]` - イベント用のカテゴリ、チャンネル、ロールを作成します
  - イベント用のカテゴリを作成
  - ログ用フォーラムチャンネルを作成
  - ロール付与用テキストチャンネルを作成
  - イベント用のロールを作成（紫色、オンラインメンバーとは別に表示）
  - 注意: イベント管理者ロールが必要です

- `/delete_event [イベント名]` - イベント用のカテゴリ、チャンネル、ロールを削除します
  - イベント用のカテゴリとその中のチャンネルを削除
  - イベント用のロールを削除
  - 注意: イベント管理者ロールが必要です

- `/add_role [ユーザー]` - イベントメンバーにロールを付与します
  - イベントロール付与チャンネルでのみ使用可能
  - 注意: イベント管理者ロールが必要です

- `/remove_role [ユーザー]` - イベントメンバーからロールを削除します
  - イベントロール付与チャンネルでのみ使用可能
  - 注意: イベント管理者ロールが必要です

### 5. リアクションロール
- クラス選択用のリアクションロール
  - リアクションを押すと自動でクラスロールを付与
  - クラスロールを付与すると「ロール未付与」ロールを自動で削除
  - リアクションを外すとクラスロールを削除
  - クラスロールを削除すると「ロール未付与」ロールを自動で付与

## 使い方

### 初期設定
1. `.env`ファイルを作成し、以下の内容を設定：
```
DISCORD_TOKEN=あなたのBotトークン
```

2. 必要なパッケージをインストール：
```bash
pip install -r requirements.txt
```

3. Botを起動：
```bash
python main.py
```

### 期の作成手順
1. `/sakuraria_create_first_roll`を実行して職員とOBのロールを作成
2. `/sakuraria_new_season [学期] [クラス数]`を実行して期のカテゴリとチャンネルを作成
3. 総合受付チャンネルにクラス選択用のリアクションロールメッセージが自動生成されます

### 期の移行手順
1. `/sakuraria_next_season [学期]`を実行
2. 指定した期の生徒にOBロールが付与されます
3. 関連するチャンネルの絵文字が📗から📙に更新されます

### 期の削除手順
1. `/sakuraria_delete_season [開始学期] [終了学期]`を実行
2. 削除対象の確認メッセージが表示されるので、確認してから削除を実行

### イベント管理手順
1. イベント管理者ロールを持つユーザーが、デバッグルームチャンネルで`/create_event [イベント名]`を実行
2. イベント用のカテゴリ、チャンネル、ロールが自動生成されます
3. イベントの削除は`/delete_event [イベント名]`で実行できます
4. イベントメンバーの管理は`/add_role`と`/remove_role`で実行できます

## 注意事項
- 管理者権限が必要なコマンドは、サーバーの管理者のみが実行できます
- 同じ期のカテゴリやロールが既に存在する場合は、新規作成できません
- 削除操作は取り消せないので、実行前に必ず確認してください
- 1期生が既にOBロールを持っている場合、`/sakuraria_next_season`コマンドは実行できません
- チャンネル名の絵文字は、新規作成時は📗、OB移行後は📙となります
- イベント管理コマンドは、イベント管理者ロールを持つユーザーのみが実行できます
- イベント管理コマンドは、デバッグルームチャンネルでのみ実行できます
- イベントロールの付与・削除は、イベントロール付与チャンネルでのみ実行できます
